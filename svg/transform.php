<?php 
//$str = "135.3044,735.30494 -0.56054,0.57031 -0.1211,0.75977 1.25,0.29883 0.11133,0.60156 -0.64062,0.25 -1.30079,-0.25 -0.23828,-0.78125 -2.08984,1.11133 -1.28125,-0.1211 -0.67969,-0.42968 1.34961,2.91015 0.54102,0.44922 0.0586,-0.46875 1.02149,0.33984 1.46875,1.72852 1.58984,0.98047 0.0898,0.78125 -0.8789,-0.0508 -1.54102,-1.16992 -0.41992,0.42968 -0.55859,1.70117 -0.29102,-0.1914 0.33008,-0.88867 -1,0.20898 -1.00977,2.87109 -1.57031,0.93946 -0.0606,1.90039 -0.42968,0.89844 -0.68946,0.4414 -1.59961,0.13867 -2.65039,-1.20898 -0.50976,0.0898 -0.15039,0.2793 0.66015,0.36133 -0.39062,0.25 -0.25977,-0.2207 0.24024,0.74023 1.41992,-0.24023 -0.0293,0.39062 -2.83008,0.93945 0.99024,0.86914 1.19922,0.041 2.40039,1.16016 0.56054,0.63867 -0.13086,0.37109 0.58008,1.33008 0.75,0.65039 1.83008,0.44922 0.5293,-0.30078 -0.0703,-0.54883 0.80079,0.67969 -0.0703,0.35937 0.58008,0.64063 0.58008,-0.0899 -0.11914,0.25977 1.09961,1.33008 4.23047,1.35937 0.52929,0.83985 0.94922,0.35156 0.27149,0.64844 1.85937,1.53125 3.13086,3.69922 1.06836,0.68945 0.51172,0.99023 0.42969,0.13086 0.67968,-1.81054 1.01954,-0.16016 2.32031,0.66992 0.65039,-0.42969 0.37891,0.2793 0.0508,-1.96875 0.67968,-1.79102 0.82032,-0.31836 0.0605,-1.5 0.56836,-0.2207 2.56055,0.69922 0.4707,0.83984 0.79883,0.1504 0.56055,-1.08008 0.65039,0 0.59961,-1.31055 -0.0801,-0.85937 -0.70898,-0.75977 1.21875,-0.91016 -2,-1.44922 -0.53907,-0.9414 0.7793,-0.29883 0.91992,-1.14062 -0.0801,-1 -1.40039,-0.75 -0.88867,-1.23047 0.0195,-0.88868 -2.46094,-0.30078 -0.27929,-1.85937 -0.67969,-1.05078 -0.69922,-0.44922 0.21875,-1.26953 1.1211,-0.22071 0.75976,0.34961 0.49024,-0.91992 0.54882,0 -0.19922,-0.98047 -0.67968,-0.52929 0.14843,-0.74024 -0.67968,-1.31055 -0.7793,-0.51953 -0.19922,-1.33984 -1.3418,0.50977 -0.75,-0.57032 -2.69921,0 -0.66016,-0.80859 0.25,-0.54102 -0.42969,-0.98047 -1.5,-0.66992 0.49024,-1.72851 -0.71094,-0.54102 -3.35938,-0.34961 -0.53906,-0.41015 -1.39062,0.78906 -0.0801,0.66992 -0.7207,0.68164 -1.5,-0.12109 -0.5,0.58984 0,-0.68945 0.64062,-1.46094 -1.51953,0.0312 -0.11133,-0.41992 -0.80859,0.16992 -0.33985,-0.25";
//$str = "8.00977,17.50977 1.16992,0.19921 0.66992,0.61133 1.10938,0.39844 0.81054,-0.39844 1.14063,0.0703 1.43945,1.19922 2.25,5.05078 -0.65039,0.25977 -0.91992,-2.54101 -0.49023,-0.45899 -0.69922,0.0586 -0.53125,1.54102 1.03125,2.28906 -0.60157,1.71094 0.47071,1.83984 -0.37891,1.25977 -1,0.85937 -2.53125,-1.54882 -1.48047,0.0996 -0.59961,-0.51954 0.66993,-0.31054 -0.16993,-0.53907 0.54102,-0.24023 -0.58008,-1.00977 0.66016,-0.34179 1.00976,1.40039 1.07032,-0.58984 -0.041,-1.25 -0.43945,0 -0.33008,-0.62891 -0.5,0.0195 -0.3711,-0.38086 0.25,-0.79883 -0.38867,-1.32031 0.57032,-0.54102 -0.0215,-0.74023 0.95117,-0.61914 -0.66992,-0.4707 0.36914,-0.38868 -0.16015,-0.56054 -0.60938,-0.22071 0.2207,-0.56836 -1.21093,-0.0801 -0.65039,-0.57032 -0.63868,1.99024 -1.16015,0.36914 -1.89063,-0.38086 -1.10937,0.12109 -1.3711,-0.57031 -0.66015,-0.68945 -0.83985,-0.14063 -0.21875,-0.43945 0.43946,-0.57031 0.48047,0.43945 0.79882,-0.13867 1.03125,0.63867 1.66016,-0.0996 2.01953,-0.90039 1.08008,-0.85937";
//$str = "99.24391,757.11709 0.185102,-0.0258 0.187253,0.11624 0.469215,0.0173 0.11407,0.10116 0.071,0.32069 -0.14421,0.0732 -0.208771,-0.0301 -0.09255,0.10331 0.02152,0.16143 0.185101,0.17433 0.52086,-0.20447 0.36375,0.21739 0.0516,0.23675 -0.0301,0.084 -0.24967,0.14851 -0.0108,0.37666 0.0624,0.11622 0.61341,0.30563 0.0839,0.49503 0.551,0.90184 -0.10331,0.1894 -0.15712,0 -0.0732,0.071 -0.009,0.17649 0,0 -0.29057,-0.005 -0.43047,0.16358 -0.31854,0.0173 -0.22815,-0.35299 -0.28841,0.028 -0.118376,-0.0732 -0.10762,-0.44769 -0.1399,-0.17649 -0.0947,-0.0452 -0.346527,0.043 -0.363744,-0.15497 -0.129141,0.0624 -0.234604,-0.33145 -0.400335,-0.29703 -0.159272,-0.23029 0.159272,-0.0818 0.0021,0.18725 0.05382,-0.0452 0.0064,0.0818 0.05381,-0.2389 0.118379,0.21523 -0.07318,-0.25827 0.08179,-0.0689 0.566066,-0.13346 0.574671,0.0345 -0.210928,-0.12698 -0.365897,-0.0624 0.163578,-0.11408 0.09901,-0.31209 -0.08394,-1.22898";

//$arr = explode(" ", $str);
//$out = "M".$arr[0];
//list($lonC, $latC) = explode(",",$arr[0]);
//for($i=1;$i<count($arr); $i++) {
  //list($lonN, $latN) = explode(",",$arr[$i]);
  //$lonC += $lonN;
  //$latC += $latN;
  //$out .= "L".$lonC.",".$latC;
//}
//$out .= "z";
//echo $out."\n";



$str= "m 135.3044,735.30494 -0.56054,0.57031 -0.1211,0.75977 1.25,0.29883 0.11133,0.60156 -0.64062,0.25 -1.30079,-0.25 -0.23828,-0.78125 -2.08984,1.11133 -1.28125,-0.1211 -0.67969,-0.42968 1.34961,2.91015 0.54102,0.44922 0.0586,-0.46875 1.02149,0.33984 1.46875,1.72852 1.58984,0.98047 0.0898,0.78125 -0.8789,-0.0508 -1.54102,-1.16992 -0.41992,0.42968 -0.55859,1.70117 -0.29102,-0.1914 0.33008,-0.88867 -1,0.20898 -1.00977,2.87109 -1.57031,0.93946 -0.0606,1.90039 -0.42968,0.89844 -0.68946,0.4414 -1.59961,0.13867 -2.65039,-1.20898 -0.50976,0.0898 -0.15039,0.2793 0.66015,0.36133 -0.39062,0.25 -0.25977,-0.2207 0.24024,0.74023 1.41992,-0.24023 -0.0293,0.39062 -2.83008,0.93945 0.99024,0.86914 1.19922,0.041 2.40039,1.16016 0.56054,0.63867 -0.13086,0.37109 0.58008,1.33008 0.75,0.65039 1.83008,0.44922 0.5293,-0.30078 -0.0703,-0.54883 0.80079,0.67969 -0.0703,0.35937 0.58008,0.64063 0.58008,-0.0899 -0.11914,0.25977 1.09961,1.33008 4.23047,1.35937 0.52929,0.83985 0.94922,0.35156 0.27149,0.64844 1.85937,1.53125 3.13086,3.69922 1.06836,0.68945 0.51172,0.99023 0.42969,0.13086 0.67968,-1.81054 1.01954,-0.16016 2.32031,0.66992 0.65039,-0.42969 0.37891,0.2793 0.0508,-1.96875 0.67968,-1.79102 0.82032,-0.31836 0.0605,-1.5 0.56836,-0.2207 2.56055,0.69922 0.4707,0.83984 0.79883,0.1504 0.56055,-1.08008 0.65039,0 0.59961,-1.31055 -0.0801,-0.85937 -0.70898,-0.75977 1.21875,-0.91016 -2,-1.44922 -0.53907,-0.9414 0.7793,-0.29883 0.91992,-1.14062 -0.0801,-1 -1.40039,-0.75 -0.88867,-1.23047 0.0195,-0.88868 -2.46094,-0.30078 -0.27929,-1.85937 -0.67969,-1.05078 -0.69922,-0.44922 0.21875,-1.26953 1.1211,-0.22071 0.75976,0.34961 0.49024,-0.91992 0.54882,0 -0.19922,-0.98047 -0.67968,-0.52929 0.14843,-0.74024 -0.67968,-1.31055 -0.7793,-0.51953 -0.19922,-1.33984 -1.3418,0.50977 -0.75,-0.57032 -2.69921,0 -0.66016,-0.80859 0.25,-0.54102 -0.42969,-0.98047 -1.5,-0.66992 0.49024,-1.72851 -0.71094,-0.54102 -3.35938,-0.34961 -0.53906,-0.41015 -1.39062,0.78906 -0.0801,0.66992 -0.7207,0.68164 -1.5,-0.12109 -0.5,0.58984 0,-0.68945 0.64062,-1.46094 -1.51953,0.0312 -0.11133,-0.41992 -0.80859,0.16992 -0.33985,-0.25 z m 8.00977,17.50977 1.16992,0.19921 0.66992,0.61133 1.10938,0.39844 0.81054,-0.39844 1.14063,0.0703 1.43945,1.19922 2.25,5.05078 -0.65039,0.25977 -0.91992,-2.54101 -0.49023,-0.45899 -0.69922,0.0586 -0.53125,1.54102 1.03125,2.28906 -0.60157,1.71094 0.47071,1.83984 -0.37891,1.25977 -1,0.85937 -2.53125,-1.54882 -1.48047,0.0996 -0.59961,-0.51954 0.66993,-0.31054 -0.16993,-0.53907 0.54102,-0.24023 -0.58008,-1.00977 0.66016,-0.34179 1.00976,1.40039 1.07032,-0.58984 -0.041,-1.25 -0.43945,0 -0.33008,-0.62891 -0.5,0.0195 -0.3711,-0.38086 0.25,-0.79883 -0.38867,-1.32031 0.57032,-0.54102 -0.0215,-0.74023 0.95117,-0.61914 -0.66992,-0.4707 0.36914,-0.38868 -0.16015,-0.56054 -0.60938,-0.22071 0.2207,-0.56836 -1.21093,-0.0801 -0.65039,-0.57032 -0.63868,1.99024 -1.16015,0.36914 -1.89063,-0.38086 -1.10937,0.12109 -1.3711,-0.57031 -0.66015,-0.68945 -0.83985,-0.14063 -0.21875,-0.43945 0.43946,-0.57031 0.48047,0.43945 0.79882,-0.13867 1.03125,0.63867 1.66016,-0.0996 2.01953,-0.90039 1.08008,-0.85937 z";
preg_match_all("/(m\s?[\d\.\,\s\-]+\s?z)/", $str, $contours);

$out = "";
$lonStart = 0;
$latStart = 0;

foreach($contours[1] as $contour) {
  $tmp = preg_replace("/^m\s?(.+)/", "$1", $contour);
  $tmp = preg_replace("/(.+)\s?z$/", "$1", $tmp);
  $tmp = trim($tmp);

  $arr = explode(" ", $tmp);
  list($lonC, $latC) = explode(",",$arr[0]);

  $lonC += $lonStart;
  $lonStart = $lonC;

  $latC += $latStart;
  $latStart = $latC;

  $out .= "M".$lonC.",".$latC;

  for($i=1;$i<count($arr); $i++) {
    //if(! $arr[$i]) {
      //echo $i." ".$arr[$i-1]."\n";
    //}
    list($lonN, $latN) = explode(",",$arr[$i]);
    $lonC += $lonN;
    $latC += $latN;
    $out .= "L".$lonC.",".$latC;
  }
  $out .= "z";
}

echo $out."\n";
 

?>


